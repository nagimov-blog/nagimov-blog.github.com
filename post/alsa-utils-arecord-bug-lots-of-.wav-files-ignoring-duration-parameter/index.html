<!doctype html><html class=no-js lang=en-us xmlns=http://www.w3.org/1999/xhtml xml:lang=en lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="alsa-utils' arecord bug: lots of *.wav files, ignoring --duration parameter"><meta name=author content><meta name=keyword content><link rel="shortcut icon" href=/favicon.ico><title>alsa-utils' arecord bug: lots of *.wav files, ignoring --duration parameter &#183; the daily meh</title><link rel=stylesheet href=https://nagimov.me/css/theme/flatly.css><link rel=stylesheet href=https://nagimov.me/css/font-awesome.min.css><link rel=stylesheet href=https://nagimov.me/css/style.css><script src=https://nagimov.me/js/jquery.min-2.1.4.js></script><script src=https://nagimov.me/js/bootstrap.min-3.3.5.js></script><script>var remark_config={site_id:'nagimov_me',theme:'light',};(function(){var d=document,s=d.createElement('script');s.src='https://remark.ngm.me/web/embed.js';(d.head||d.body).appendChild(s);})();</script><script>(function(f,a,t,h,o,m){a[h]=a[h]||function(){(a[h].q=a[h].q||[]).push(arguments)};o=f.createElement('script'),m=f.getElementsByTagName('script')[0];o.async=1;o.src=t;o.id='fathom-script';m.parentNode.insertBefore(o,m)})(document,window,'//fathom.ngm.me/tracker.js','fathom');fathom('set','siteId','RYEFY');fathom('trackPageview');</script><link href rel=alternate type=application/rss+xml title="the daily meh"></head><body lang=en><div class=container><div class=row><div class="navbar navbar-default" role=navigation><div class=navbar-header><a class=navbar-brand href=https://nagimov.me>the daily meh</a></div><div class="navbar-collapse collapse navbar-responsive-collapse"><ul class="nav navbar-nav navbar-right"><li><a href=https://nagimov.me>Home</a></li><li><a href=https://nagimov.me/post/>Posts</a></li><li><a href=/about/>About</a></li></ul></div></div></div></div><div class=container><div class=row><div class="col-md-offset-1 col-md-10" style=display:flex;justify-content:space-between><div><h3>alsa-utils' arecord bug: lots of *.wav files, ignoring --duration parameter</h3></div><div>&nbsp;&nbsp;&nbsp;&nbsp;</div><div style=margin-bottom:10.5px;margin-top:21px><span class="label label-primary">2016-08-18</span></div></div></div><div class=row><div class="col-md-offset-1 col-md-10"><p><img src=/images/alsamixer.png#center alt=width500px></p><p>While working on a little side project, I found that I can&rsquo;t record sound using Raspberry Pi with external USB sound card after upgrading it to Raspbian Jessie. Symptoms look rather weird: <code>arecord</code> doesn&rsquo;t stop recording after a period of time specified by <code>--duration</code> flag, but keeps running and writing garbage to files like <code>*-01.wav</code>, <code>*-02.wav</code> and so on. Google doesn&rsquo;t really give any solution to this (except <a href=http://superuser.com/questions/583826/recording-using-arecord-creates-thousands-of-files>the recommendation</a> of terminating <code>arecord</code> using <code>killall -KILL arecord</code> after certain period of time). USB microphones are <a href="https://www.raspberrypi.org/forums/viewtopic.php?f=66&t=138722">also affected</a>.</p><p>Considering I have another Raspberry Pi running Wheezy and having no problems at all (and being free of systemd malware ;) that looks like a bug of <code>arecord</code>. Debian Jessie <a href=https://packages.debian.org/jessie/alsa-utils>includes</a> <code>alsa-utils</code> of version <code>1.0.28</code> and <code>arecord --version</code> on my Raspbian (image <code>2016-05-27-raspbian-jessie.img</code>) gives the same. Here is <a href=http://superuser.com/questions/583826/recording-using-arecord-creates-thousands-of-files>the report</a> that version <code>1.0.27</code> of Linux Arch also suffers from that. Debian Wheezy <a href=https://packages.debian.org/wheezy/alsa-utils>has</a> alsa-utils <code>1.0.25</code> and it&rsquo;s free of this bug. Hence, the bug was introduced in either <code>1.0.26</code> or <code>1.0.27</code> version of <code>alsa-utils</code>, and downgrading it to a version below <code>1.0.26</code> should help.</p><p>Here is how to do that in Raspbian Jessie (change the repo url according to your version):</p><ul><li>Firstly we are adding Wheezy&rsquo;s repo to the system. Add <code>deb http://mirrordirector.raspbian.org/raspbian/ wheezy main contrib non-free rpi</code> line to the end of <code>/etc/apt/sources.list</code> file.</li><li>Update the sources: <code>sudo apt-get update</code>.</li><li>Check available versions of the package: <code>sudo aptitude versions alsa-utils</code>. This should indicate that an older version of <code>alsa-utils</code> is now available.</li><li>Install the older version (whichever is available): <code>sudo apt-get install alsa-utils=1.0.25-4</code>.</li><li>Now verify that <code>arecord</code> works fine. For USB sound card detected as a device #1, command is as follows: <code>arecord -D plughw:1,0 -r 44100 -f cd -d 5 -vv ~/test.wav</code>. Recording should stop in 5 seconds.</li><li>Revert the changes made to <code>/etc/apt/sources.list</code> (just comment the newly added line) and update the sources again: <code>sudo apt-get update</code>.</li></ul><p>Have fun arecording!</p><hr></div></div><div class=row><div class="col-md-offset-1 col-md-10" style=display:flex;justify-content:space-between><div>Tagged
#<a href=/tags/raspberry-pi>raspberry pi</a>
,
#<a href=/tags/usb-audio>USB audio</a>
,
#<a href=/tags/usb-microphone>USB microphone</a>
,
#<a href=/tags/raspbian>Raspbian</a>
,
#<a href=/tags/debian>Debian</a>
,
#<a href=/tags/jessie>Jessie</a>
,
#<a href=/tags/wheezy>Wheezy</a>
,
#<a href=/tags/alsa-utils>alsa-utils</a>
,
#<a href=/tags/arecord>arecord</a>
,
#<a href=/tags/apt>apt</a>
,
#<a href=/tags/apt-get>apt-get</a></div><div><span class="label label-primary">2016-08-18</span></div></div></div><div class=row><div class=col-md-12><hr></div></div><div class=row><div class="col-md-offset-1 col-md-10"><div id=remark42></div></div></div></div><div class=container><div class="row col-md-12"><footer><div class=pull-left><p>&copy; ~ Powered By <a href=http://hugo.spf13.com>Hugo</a> - version: 0.68.3 ~ <a href=https://creativecommons.org/licenses/by/4.0/>License: CC BY 4.0</a></p></div><div class=pull-right><a href=https://github.com/nagimov target=_blank><i class="fa fa-github-square fa-2x"></i></a></div></footer></div></div></body></html>